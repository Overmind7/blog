# 函数

## Ｃ++的程序结构

组成

- 预处理指令

    - 如`#define`和`#include <filename>`等；
    - 在程序中都是以 # 开头的

- 全局声明

    - 在函数外对数据类型、函数和变量的声明和定义

- 函数

    - 包含函数首部和函数体

    

## 函数（Function）

  一个函数就是一个功能

### main 函数

  1、  一个程序文件只能有一个主函数

​    程序总是从main函数开始执行的，main函数由系统调用

​    '**由主函数调用其他函数，其他函数可以互相调用，但是不能调用main函数**'

​    主函数的作用：调用其它函数

​    主函数以外的函数大多是封装在'**类**'里的（通过类对象调用）

  2、 标准C++要求main函数必须声明为 `int `型

-  `  void main() `也能通过，无返回值的主函数

  3、  函数调用举例

```cpp
#include <iostream>
using namespace std;
void printstar(void){
    cout << "*******" << endl;
}

int main(){
    printstar();
    return 0;
}
```

说明：

  1、`void` ： `void printstar(void)`

第一个 void 表示无返回值函数

第二个 void 表示调用时'**不能**'也不必给出参数，可以省略这个 void （无参函数）

  2、所有函数都是平行的（包括main函数），相互独立

一个函数并不属于另一个函数

不能在一个函数中定义另一个函数（嵌套定义）

不能在主函数main中定义

  3、声明位置

- 若在main函数之后定义，则要'先声明'才能被main调用
- 定义位置在main之前则不用声明}



### 函数分类

1. 系统函数（库函数）   `#include <filename>`

2. 自定义函数：

- 无参函数：调用时不必给参数：   
    - 有返回值
    - 无返回值
        - 以无返回值的居多**主函数与其之间没有数据传递，一般执行固定操作**

- 有参函数：调用时必须给出参数('在主函数和被调用函数之间有数据传递')

有返回值供主函数使用

也可无返回值（`void`）



### 定义函数



  1、定义无参函数

```cpp
typename 函数名(void)  //void可以省略，该行无分号
{
    声明部分；
    执行语句；
}
```

  2、定义有参函数

```cpp
typename 函数名(形式参数表列) //函数首部，形参的类别在这里要声明
{
    声明部分；
    执行语句；
}
```



### 函数参数

形式参数'`parameter`'：定义时的变量名 

- ⚠️！注意是定义时的变量名

实际参数'`argument`'：调用时的参数（表达式）

说明：

- '**形参未被调用时，不占内存**',因此称为"**形式参数**"或者"**虚拟参数**"，调用时分配内存以接受实参的数据，调用结束之后形参内存释放
- 实参可以时'**常量、变量或者表达式**'(必须是确定的值)
- 函数的首部'**声明形参类型**'
- 实参与形参的类型应该'**相同或者赋值兼容**'（eg：`char `与 `int `），若不同则按照赋值规则进行转换,'**实参附给形参**'
- 实参向形参的数据传递是值传递（单向传递）
    - 调用函数时，编译系统临时给形参分配内存
    - 实参与形参上不同单元
    - 执行函数时，形参值改变，与实参无关（实参值不受影响）



### 函数的返回值

  通过函数的调用，使主函数能得到一个确定的函数值

- return 返回值

​    将被调用函数中的一个确定的值带回主函数

​    可以无返回值，可以有多个 return （执行到哪个，哪个起作用）

```cpp
return Z <=> return(Z) //可以不要括号
return(x > y ? x : y)  //可以是表达式
```

- 返回值的类型

由定义函数时的函数类型决定

若 return 的类型与函数值类型不一致，'**以函数类型为准，函数类型决定返回值类型**'

对于数值类型可以自动进行类型转换



## 函数调用

### 一般形式

```cpp
functionname([argument]) //函数名+实参表列
```

​    其中圆括号不能省略，可以没有实参表列

​    用逗号隔开多个实参

​    实参与形参的个数相等，类型匹配，按顺序一一对应传递数据

​    不同编译器对于多个实参的求值顺序不同，例如：

```cpp
func(i,++i);
```

​    若从左到右，则为 `func(3,4)`

​    若从右往左，则为 `func(3,3)`,如`VC++`和`GCC`

> （函数参数的压栈顺序与函数的声明顺序相反？）

其他要求

- 必须时已经存在的函数；
- 如果是库函数需要` #include <filename>`加头文件
- 如果是自定义函数，需要与调用它的主函数在同一个程序单位中，'若位置在主函数之后，还需要在调用前声明'



作用：

函数调用作为单独的语句，要求函数完成一定操作

函数表达式：带回一个确定时值参加表达式的计算

函数参数：函数调用作为另外一个函数的实参

`m = max(a, sqrt(b));`



### 函数声明

在函数尚未定义的情况下，先将函数的有关信息通知给编译系统，以便编译正常进行。

声明和定义不是一回事：

- 定义：对函数功能的确立，是一个完整独立的函数单位

- 声明：把函数的有关信息（名字、类型、形参及其类型、函数体等通知编译器）



'**声明中也可以不写形参名，只写形参类型**'例如：

`float add(float,float);`

这种声明方法称为'**函数原型'(function prototype)**,作用:

'**根据函数原型在程序编译阶段对调用函数的合法性进行全面检查**'  

函数原型的一般形式为：（基本形式）

```cpp
typename functioname(typename, typename, ……);
//函数类型 函数名（参数类型1，参数类型2，……）；
```

或者为了便于阅读

```cpp
typename functioname(typename parameter, typename parameter,……);
// 函数类型 函数名（参数类型1 参数名1， 参数类型2 参数名2，……）；
```

编译系统不检查参数名，写成什么都无所谓

主要保证函数原型与函数首部写法上一致（函数类型、函数名、参数个数、参数类型、参数顺序）

'**对函数的外部声明**'：函数声明的位置可以在函数外面，在所有函数定义之前

-  如果一个函数被多个函数调用，这样可以不必在每个主调函数中重复声明



### 函数的嵌套调用

c++不能嵌套定义函数，但是能够嵌套调用

在调用一个函数的过程中调用另一个函数



### 函数的递归调用

在调用一个函数的过程中又直接或者间接地调用该函数本身，称为函数的递归（recursive）调用

包含递归调用的函数称为递归函数





## 有默认参数的函数

#### 一个参数

当用同样的实参调用同一个函数的时候，Ｃ++中能够给实参一个默认的值

例，有函数声明如下

```cpp
float area(float r=6.5);
```

指定r的默认值为 6.5 ，在以默认参数调用时，不必给出实参的值

```cpp
area();  //相当于 area(6.5)
```

如果不想用默认值，则通过实参另行给出

```cpp
area(7.4); //形参得到的值时7.4而不是默认值6.5
```



#### 多个形参

可以使每个形参都有一个默认值，也可以只对一部分形参指定默认值，一部分不指定

  例，求一个圆柱体体积

```cpp
float volume(float h,float r = 12.5);  //函数声明（函数原型），只对形参r指定默认值12.5
```

  调用可以

```cpp
volume(45.6);   //相当于 volume(45.6,12.5)
volume(12,31);   //两个参数都不采用默认值
```

  注意⚠️   '实参与形参的结合是从左往右进行的，因此指定默认值必须放在形参表列中的最右端'

例：  

```cpp
void f1(float a,int b =0,int c,char d ='a');  //不正确
void f2(float a,int c,int b = 0,char d = 'a'); //正确，将带有默认参数的形参放到右边
```

对于 `f2()`的调用

```cpp
f2(1.2,2,4,'x');  //形参的值全部从实参得到
f2(3.2,5,2);    //最后一个形参取默认值
f2(3.5,5);     //最后两个形参取默认值b=0，d=‘a’
```

3、应用举例

求两个或三个'正整数'数的最大值，用默认参数的函数实现

```cpp
#include <iostream>
using namespace std;
int main(){
    int max(int a,int b,int c = 0);
    int a,b,c;
    cin>>a>>b>>c;
    cout<<"max(a,b,c)"<<max(a,b,c)<<endl;
    cout<<"max(a,b)"<<max(a,b)<<endl;
    return 0;
}

int max(int a,int b,int c){
    if (b>a) {
        a=b;
    }
    if (c>a) {
        a=c;
    }
    return a;
}
```

注意

- 如果函数定义是在函数调用之前：
    - 则应该在函数定义中给出默认值
- 如果函数定义是在函数调用之后：
    - 则在函数调用之前需要有函数声明，此时必须在函数声明中给出默认值

- 总之必须在函数调用之前将默认信息告知编译系统

::: tip 

重复指定默认值报错信息，最好只在声明时指定默认值

:::

::: warning

一个函数不能既作为重载函数，又作为有默认参数的函数

二义性

:::



## 内部函数和外部函数

函数本质上是全局的（因为被其他函数调用）

但是也可以指定函数只能被本文件调用，而不能被其他文件调用

### 内部函数

**如果一个函数只能被本文件中的其他函数调用，则被成为内部函数**

内部函数又称为静态（static）函数

通常把只能由同一文件使用的函数和外部变量放在一个文件中，在它们前面加上 static 局部化，使其他文件不能使用

2、使用

在定义内部函数时，在函数名和函数类型的前面加 static 

函数首部的一般格式为：

```cpp
static 类型标识符 函数名(形参表)
```

例如

```cpp
static int func(int a,int b)
```



### 外部函数

在定义函数时，**如果在函数首部的最左端冠以关键字 extern，则表示此函数是外部函数，可供其他文件调用**

如果在定义函数时省略 `extern`，则'`默认`'为外部函数

在需要调用此函数的文件中，用 `extern `声明所用的函数是外部函数

2、使用

```cpp
extern int func(int a,int b)
```

​    这样函数 `func `就可以被其他文件调用

3、说明

使用 `extern `声明能够将其他文件中函数的作用域扩展到本文件中

`extern `声明的形式是在函数原型的基础上加关键字 `extern`

```cpp
extern int max(int,int);
```

Ｃ++中允许在声明函数时省略 extern（函数在本质上是外部的）

```cpp
int max(int,int);
```

此时就是函数原型

函数原型：

- 用函数原型能够把函数的作用域扩展到到定义该函数的文件之外（不必使用 `extern`）
- 只要在使用该函数的每一个文件中包含该函数的原型即可
- 函数原型通知编译系统：该函数在本文件中稍后定义或者在另一个文件中定义
- 函数原型扩展作用域最常见例子： `#include <filename>` 指令。
    - `#include <cmath>`



## 内置函数

1. 概念

函数调用过程：~

如果函数频繁调用，会降低运行效率

Ｃ++能够在编译时将所调用函数的代码直接嵌入主调函数中，而不是将流程转出去

- 这种嵌入到主调函数中的函数成为'**内置函数**' `inline function`

- 又称 '**内嵌函数**'或者'**内联函数**'

2. 使用

举例：

```cpp
#include <iostream>
using namespace std;

inline int max(int,int,int);    //声明内置函数

int main(){
    int i = 10,j = 20,k = 30,m;
    m = max(i,j,k);
    cout << "max = "<<m<<endl;
    return 0;
}

inline int max(int a,int b,int c){  //定义内置函数
    if (b > a) {
        a = b;
    }
    if (c > a) {
        a = c;
    }
    return a;
}
```

程序分析：

在指定了 inline 函数之后，在编译时调用函数的语句 `max(i,j,k)` 就被替换成 `max `的函数体，同时用实参代替形参

::: tip 注意⚠️

可以在声明和定义函数的时候同时写 `inline `，也可以只在函数声明时加 `inline`，而定义函数时不加 `inline`。

**只要在调用函数之前把 inline 信息告知编译系统，就会按照内置函数处理**

:::

3. 使用条件

只将规模很小（五句以下）且使用频繁的函数声明为内置函数（函数规模很小时，函数调用开销甚至超过执行函数本身）

内置函数中不能包括复杂的控制语句，如循环语句和 switch 语句

::: warning

`inline `声明是一个'建议性的语句而不是指令性的'，编译系统会根据具体情况决定是否这样做

:::

​    

## 函数模版

Ｃ++提供了函数模版，以解决函数体完全相同，参数类型不同的情况

'函数模版实际上是建立一个通用函数，其函数类型和参数类型不具体指定，用一个虚拟的类型来代表，这个通用函数就称为函数模版'

凡是函数体相同的函数都可以用这个模版来代替，在调用函数时系统哦会根据实参的类型来取代模版中的虚拟类型

例，将函数重载（max）中的例子用函数模版实现

⚠️注意：'只适用于函数体相同，函数参数个数相同而类型不同的情况'

```cpp
#include <iostream>

using namespace std;
template <typename T>   //模版声明，其中T为类型参数

T max(T a,T b,T c){    //定义一个通用函数，用T作虚拟的类型名
    if (b > a) {
        a = b;
    }
    if (c > a) {
        a = c;
    }
    return a;
}

int main(){
    int i1=1,i2=2,i3=3,i;
    double d1=1.3,d2=4.2,d3=5.2,d;
    long g1=123445,g2=987655,g3=2345432,g;
    i = max(i1,i2,i3);            //调用函数模版，此时T被int取代
    d = max(d1,d2,d3);            //调用函数模版，此时T被double取代
    g = max(g1,g2,g3);            //调用函数模版，此时T被long取代
    cout<<i<<'\n'<<d<<'\n'<<g<<endl;
}
```

  定义函数模版的一般形式为

```cpp
template <typename T>
```

通用函数定义；

或者为

```cpp
template <class T>
```

通用函数定义；

说明  

- `template `的含义是模版，在函数调用时才能确定`T`为什么类型，T也可以换成其他字母
- `class `和 `template `的作用相同，都表示类型名，可以互换，用 `typename `更好;
- **类型参数可以不止一个**，如 `template <class T1,typename T2>`
- 通常情况下，函数模版参数个数不能为 0 个

此外，如果输入的两个参数不同，可以强制转换成同一个参数，例

```cpp
template <typename T>
T fun(T x,T y){
    return x*y;
}
```

调用 `fun` 时

```cpp
fun<float>(2,2.3)
```

此时将两个参数都转换为float型，防止编译出错





## 函数重载

Ｃ++允许用同一个函数名定义多个函数，而这些函数的参数个数和参数类型不相同

这就是'**函数重载**'，即'对一个函数名重新赋予它新的含义，使一个函数名可以多用。所谓重载，其实也就是"一物多用"'。

不仅函数可以重载，运算符也可以重载

函数重载举例

求两个或者三个整数的最大数

```cpp
#include <iostream>
using namespace std;

int main(){
    int max(int a,int b,int c);        //函数声明
    int max(int a,int b);           //函数声明
    int a = 8,b = -12,c = 27;
    cout<<"max(a,b,c)="<<max(a,b,c)<<endl;  //输出三个整数中的最大数
    cout<<"max(a,b)="<<max(a,b)<<endl;    //输出两个整数中的最大数
}

int max(int a,int b,int c){    //求三个整数中的最大数
    if (b>a) {
        a = b;
    }
    if (c > a) {
        a = c;
    }
    return a;
}

int max(int a,int b){       //求两个整数中的最大数
    if (b > a) {
        return a;
    }
    else {
        return b;
    }
}
```

说明：

- 两次调用max函数的参数个数不同，系统根据这些不同找到与之匹配的函数
- 参数的个数和类型可以都不同，但不能只有函数的类型不同而参数的个数和类型相同
    - '**重载函数的参数个数、参数类型或参数顺序三者中至少有一个不同**'，否则调用形式一样 f(x) 编译系统无法判断调用哪一个

函数的返回值可以相同可以不同（无规定）



## 常用标准库函数

常用数学函数

常用字符函数

常用字符串函数

