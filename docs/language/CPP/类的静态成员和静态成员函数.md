# 类的静态成员和静态成员函数



## 类的静态数据成员

如果想在同类的多个对象之间实现数据共享，也不要用全局对象，可以用静态的数据成员

### 静态数据成员

静态数据成员是一种特殊的数据成员，以关键字 static 开头，例如：

```cpp
class Box{
	public:
		……
	private:
		static int height;   //把height定义为静态的数据成员
		int width;
		int length;
};
```

如果希望各个对象中的数据成员的值是一样的，就可以把它定义为静态数据成员

- 为各个对象所'**共有**'，所有对象都能引用

- 在内存中只占一份空间，而不是每个对象分别为它保留一份空间，节约空间提高效率



1. 之前说过在声明类时数据成员不占有内存空间，在定义对象时才分配内存空间。

::: tip 但是静态数据成员**不属于任何一个对象**

在为对象所分配的空间中不包括静态数据成员所占的空间。

静态数据成员是在所以对象之外单独开辟空间。

只要在'**声明类的时候指定了静态数据成员，这时候就会为其分配内存**'，

**即使使不定义对象，静态数据成员也可以被引用**

:::



2. 静态数据成员与静态变量类似，不随对象的建立而分配空间，也不随对象的撤销而释放。

> 静态数据数据成员在程序开始运行时就分配空间，到程序结束的时候释放空间

3. **初始化静态数据成员**

​	**只能在类体外初始化**，例：

```cpp
int Box::height = 10;
```

一般类型为：

```cpp
数据类型 类名::静态数据成员名 = 初值；
```

**不能用参数初始化表对静态函数成员初始化**

```cpp
Box(int h,int w,int l):height(h){}; //错误！height是静态数据成员
```

​	

4. 静态数据成员既可以通过对象名引用，也可以通过类名引用

例：

有两个Box对象a，b；引用**public**静态数据成员`height`

a.height 或者 b.height 或者 Box::height

- 在类外可以通过'**对象名**'访问公用的静态数据成员，也可以通过'**类名**'引用静态数据成员
    - 这说明静态数据成员不是属于对象的，而是属于类的，但是能够被对象引用。
    - 通过静态数据成员，各个对象之间有了沟通的渠道，实现数据共享，可以不使用全局，全局变量破坏了封装的原则，不符合面向对象程序的要求

- 注意公用静态函数成员和全局变量的区别：'**静态数据成员的作用域只限于定义该类的作用域内**'，如果实在一个函数中定义类，那么其中静态数据成员的作用域就在此函数内。
    - 在此作用域内，可以通过类名和域运算符`::`引用静态数据成员，而不论对象是否存在		



### 静态成员函数

- 成员函数也可以定义为静态的，在类中声明函数的前面加上 static 就成了静态成员函数，例：

```cpp
static int volum();
```

和静态数据成员一样，**静态成员函数是类的一部分而不是对象的一部分**

- 在类外调用公用的静态成员函数，要用类名和域运算符

    ```cpp
    Box::volum();
    ```

    同时也允许通过对象名调用静态成员函数

    ```cpp
    a.volume();
    ```

    这里不是说该函数属于对象a，而是使用了a的类型Box

- 与静态数据成员不同，静态成员函数的作用不是为了对象之间的沟通，而是为了处理静态数据成员

    '**静态成员函数不属于某一对象，与任何对象都无关，没有this指针**'，

    所以无法对一个对象中的非静态成员进行默认访问（即在引用数据时不指定对象名）

    ::: warning 静态成员函数与非静态成员函数的根本区别：

    ​    非静态成员函数有 this 指针，而静态成员函数没有 this 指针。
    ​    由此决定了静态成员函数不能访问本类中的非静态成员。

    :::

- 静态成员函数可以直接引用本类中的'**静态成员**'
    - 因为静态成员同样是属于类的，可以直接引用。
    - 在C++程序中，'静态成员函数主要用来访问静态数据成员，而不访问非静态成员'。

如果一定要访问：假设a为Box类，在静态成员函数中		

```cpp
cout<< a.width <<endl; //引用本类对象a中的非静态成员
cout<< height << endl; //若height已经声明为static，则是引用本类中的静态成员，合法
```

- 程序举例

```cpp
#include <iostream>
using namespace std;
class Student{                     //定义student类
	public:
		Student(int n,int a,float s):num(n),age(a),score(s){} //定义构造函数
		void total();             //声明成员函数
		static float average();   //声明静态成员函数
	private:
		int num; 
		int age;
		float score;
		static float sum;         //静态数据成员sum
		static int count;         //静态数据成员count 
};
void Student::total(){            //定义非静态成员函数
	sum += score;                 //累加总分
	count++;                      //累加已统计的人数
}
float Student::average(){         //定义静态成员函数
	return(sun/count);
}
float Student::sum = 0;           //初始化静态数据成员
int Student::count = 0;           //初始化静态数据成员
int main(){
	Student stud[3]={             //定义对象数组并初始化
		Student(1001,18,70),
		Student(1002,19,78),
		Student(1005,20,89)
	};
	int n;
	cout<<"please input the number of students:";
	cin>>n;                       //输入需要求签名多少学生的平均成绩
	for (int i=0; i < n; i++) {   //调用3次total函数
		stud[i].total();
	}
	cout<< "the average score of "<<n<<" students is "<< Student::average()<< endl; 
	return 0;                                            //调用静态成员函数
}
```

说明	

1. 在Student类中定义了两个静态数据成员sum（总分）和count（累计统计的学生人数），因为这两个数据成员的值是需要进行累加的，不从属于某一个单独的对象，而是多个对象元素共有的
2. total时公用的成员函数，将一个学生的成绩累加到sum中。

**公用到成员函数可以引用本对象中的一般数据成员，也可以引用类中的静态数据成员**

3. average是静态成员函数，它可以直接引用私有的静态数据成员（不必加类名或者对象名）

4. 在main函数中，引用普通成员函数要加对象名，引用静态成员函数要**加类名**或者**对象名**

5. 注意对象的作用域对于静态成员函数引用非静态数据成员的影响：

    解决方法举例：在main外定义对象，则为全局；将对象作为参数，好处是实参可以改变



> **只用静态成员函数引用静态数据成员，而不引用非静态数据成员**，这样逻辑清晰，不易出错

