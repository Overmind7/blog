# 输入与输出

## 标准输入输出流

### 标准输出流

`cout`、`ceer`、`clog`流

#### `cout`流对象

`cout`（console output）意思是在控制台输出

`cout`不是Ｃ++预定义的关键字，它是 ostream 流派生类的对象，在 iostream 头文件中定义

`cout`流中的数据是用流插入运算符 `<<` 顺序加入的

`cout`流是容纳数据的载体，不是一个运算符

用`cout<<`输出标准类型的时候，系统已经定义了重载函数，不必考虑什么类型

- 对用用户自定义类型，需要自己重载

`cout`流在内存内开劈了一个缓冲区，用来存放流中的数据

- 当向流中插入一个`endl`时，无论缓冲区是否已满，立即输出，再插入一个换行符，并刷新流（清空缓冲区）

#### `cerr`流

1. 概念

`cerr`流时'标准错误流'

与显示器关联

向标准错误设备显示错误信息

2. 比较

与`cout`用法类似，不同点：

`cout`除了在显示器上显示，还能重新定向输出到磁盘文件

`cerr`流中的信息只能在显示器输出；  

3. 用处

避免出错信息输出到文件中，在显示器上即时输出，用`cerr`流来确保

`cerr`流中的信息时用户根据需要指定的。

#### `clog`流对象

`clog `也是标准错误流，作用与cerr`相同`

不同点：

`cerr`不经过缓冲区直接向显示器输出

`clog`中的信息放到缓冲区中，缓冲区满或者遇到 `endl `之后才向显示器输出。

​        

​        

#### 标准类型数据的格式输出

1、使用控制符控制输出格式

需要头文件

`#include <iomanip>`

2、用流对象的成员函数控制输出格式

  

#### 用流成员函数 `put`输出字符

1、概念

2、形式



### 标准输入流

`cin`流

在头文件`iostream`中定义的 `cin`、`cout`、`cerr`、`clog`中，后三个是输出流

`cin`是输入流

​    



## 对ASCII文件的操作

如果文件的每一个字节均以ASCII代码形式存放数据，即每一个字节存放一个字符，这个文件就是ASCII文件（或称字符文件）

1、用流插入运算符“`<<`”和流提取运算符“`>>`”输入输出标准类型的数据

  `<<` 和 `>>` 都已经在 `iostream`中被重载为能用于 `ostream` 和 `istream`类对象的标准类型的输入输出 

  且 `ifstream `和 `ofstream`分别是 `istream`和 `ostream `类的派生类，因此它们继承了公用的重载函数，可以同 `cin` `cout`一样对标准设备读写

2、用文件流的 `put` ，`get`，`getline `等成员函数进行字符的输入输出

3、几个例子

  1、有一个整型数组，含十个元素，从键盘输入 10 个整数给数组，将此数组送到磁盘文件中存放

```cpp
#include <fstream>
using namespace std;
int main(){
    int a[10];
    ofstream outfile("f1.dat",ios::out);  //定义文件流，打开磁盘文件 f1.dat
    if (!outfile) {            //如果打开失败，outfile 返回 0
        cerr << "打开文件失败！"<<endl;
        exit(1);
    }
    cout <<"enter 10 integer numbers:"<<endl;
    for (int i = 0; i < 10; i++) {
        cin >>a[1];
        outfile <<a[i]<<" ";  //向磁盘文件 f1.dat 输出数据
    }
    outfile.close();      //关闭磁盘文件 f1.dat
    return 0;
}
```

程序分析：

1. `#include` 指令包含了头文件 `fstream`，这是由于在程序中用到了文件流类 `ofstream `是在头文件 `fstream `中定义的

`#include <fstream>` 中包含了头文件 `iostream `所以可以用 `cout` `cin`，不用重复写

2. 程序中用 `ofstream `类定义文件流对象 `outfile `

调用结构函数打开磁盘文件 `f1.dat`，它是输出文件，只能向它写入数据，不能从中读取数据

**`ios::out`为默认格式，可以省略**

```cpp
ofstream outfile("f1.dat",ios::out);
ofstream outfile("f1.dat");
```

3. 文件打开结果

如果打开成功，

- 文件流对象 `outfile `返回值为非0值

如果打开失败，

- 则返回值为 0，(!outfile) 为真，输出错误信息
- 调用系统函数 `exit()``
    - `exit()`函数的参数可以为任意整数（可能需要头文件 `stdlib.h`）

4. 在程序中用提取运算符 << 从键盘逐个输入 10 个整数

​        向磁盘文件输出，输出语句为

```cpp
outfile<<a[i]<<" ";
```

​          输出语句与向显示器输出类似，把标准输出流对象 cout 换成了文件输出流对象 outfile

  

  2、从上例中建立的文件 f1.dat 中读入十个数据放在数组中，找出并输出这十个数字中最大的和它的编号

```cpp
#include <fstream>
using namespace std;

int main(){
    int a[10],max,i,order;
    //定义输入文件流对象，以输入方式打开磁盘文件
    ifstream infile("f1.dat",ios::in|ios::nocreate); 
    if (!infile) {
        cerr<<"open error!"<<endl;
        exit(1);
    }
    for (i = 0; i < 10; i++) {  //对字符逐个处理，直到遇到 /0 为止， /0 的 ASCII 序号为 0
        infile>>a[i];      //从磁盘文件中读入十个整数到a数组中
        cout<<a[i]<<'\t'<<endl; //在显示器上顺序显示10个数
    }
    cout<<endl;
    max = a[0];
    order = 0;
    for (i = 0; i < 10; i++) {
        if (a[i] > max){
            max = a[i];
            order = i;
        }
    }
    cout<<"max= "<<max<<endl
        <<"order= "<<order<<endl;
    infile.close();
    return 0;
}
```

  3、从键盘读入一行字符，把其中的字母字符依次存放到磁盘文件 `f2.dat` 中，再把从磁盘文件中读入程序，将小写字母改成大写，放到磁盘文件 `f3.dat `中

```cpp
#include <iostream>
using namespace std;

//定义函数从键盘读入一行字符，并将其中的字母存入磁盘文件
void save_to_file(){
    //定义输出文件流对象 outfile，以输出的方式打开磁盘文件 f2.dat
    ofstream outfile("f2.dat");
    if (!outfile) {
        cerr<<"Open f2.dat error!"<<endl;
        exit(1);
    }
    char c[80];
    cin.getline(c,80);
    for (int i = 0; c[i] != 0; i++) {  
        //对字符逐个处理，直到遇到 /0 为止， /0 的 ASCII 序号为 0
        if (c[i] >= 65 && c[i] <= 90 ||c[i]>= 97 && c[i] <= 122) {  //如果是字母字符
            outfile.put(c[i]);  //将字母字符存入磁盘文件 f2.dat
            cout <<c[i];     //同时送显示器显示
        }
    }
    cout<<endl;
    outfile.close();  //关闭 f2.dat

//从磁盘文件f2.dat 读入字母字符，将其的小写字母字母改为大写字母，再存入 f3.dat
    
void get_from_file(){
    char ch;
    ifstream infile("f2.dat",ios::in|ios::nocreat);
    //定义输入文件流 infile，以输入方式打开磁盘文件 f2.dat
    if (!infile) {
        cerr<<"open f2.dat error!"<<endl;
        exit(1);
    }
    ofstream outfile("f2.dat");
    //定义输出流文件，以输出方式打开磁盘文件 f3.dat
    if (!outfile) {
        cerr<<"open f3.dat error!"<<endll
        exit(1);
    }

    while (infile.get(ch)) {      //当读取字符成功，指向下面的复合语句
        if (ch >= 97 && ch <= 122) {  //判断是否为小写字母
            ch = ch -32;        //将小写字母改为大写字母
            outfile.put(ch);      //将该大写字母存入磁盘文件 f3.dat
            cout << ch;         //同时在显示器输出
        }
    }
    cout << endl;
    infile.close();  //关闭磁盘文件 f2.dat
    outfile.close(); //关闭磁盘文件 f3.dat
}

int main(){
    save_to_file();  //调用函数，从键盘读取一行字符，并将其存入磁盘文件 f2.dat
    get_from_file(); //调用函数，从 f2.dat 读入字母字符，改为大写字母，再存入 f3.dat
    return 0;
}
```

程序分析：

用文件流的 `put` `get` `getline` 等成员函数实现输入与输出

- `cin` 和 `infile` 都是 `istream` 类的对象

- 因此在之前介绍的成员函数都可以对磁盘文件输入输出

- 区别在于对标准设备显示器输入用 `cin` ，对磁盘文件输出时用 文件流对象

​        

从显示器上看 ASCII 文件的内容

1. 在widows系统下，从记事本打开

2. 用一个函数将磁盘文件内容读入内存，再输出到显示器

```cpp
#include <fstream>
using namespace std;

void display_file(char *filename){
    ifstream infile(filename,ios::in|ios::nocreat);
    if (!infile) {
        cerr<<"open error!"<<endl;
        exit(1);
    }
    char ch;
    while (infile.get(ch)) {
        cout.put(ch);
    }
    cout<<endl;
    infile.close();
}

int main(){
    display_file("f3.dat");
    return 0;
}
```





## 对二进制文件的操作

  1、概念

​    将内存中数据储存形式不加转换地传送到磁盘文件中

​    又称为内存数据的映像文件

​    对二进制文件的操作也要先打开文件，用完之后关闭

​      打开时用 `ios::binary` 指定以二进制形式传送和储存

​    与ASCII不同：

​      二进制文件除了可以作为输入文件或输出文件

​      还可以'既能输入又能输出的文件'

  2、用成员函数 `read `和 `write `读写二进制文件

​    1、函数原型

```cpp
istream& read(char *buffer,int len);
istream& write(const char * buffer,int len);
```

字符指针 `buffer `指向内存中的一段储存空间

`len `是读写的字节数。

​    2、调用

```cpp
a.write(p1,50);
```

a是输出文件流对象

write函数将字符指针 p1 指向的单元开始的50个字节内容不加转换的写到与 a 关联的磁盘文件中。

```cpp
b.read(p2.30);
```

`b`是输入文件流对象

`read`函数从b所关联的磁盘文件中，读入30个字节（或遇`EOF`）解释

存放在字符指针 `p2 `指向的一段空间内

​        



## 文件与文件流

### 概念

文件（file）一般指储存在外部介质上数据的集合

操作系统以文件为单位对数据进行管理

#### 分类

  对于用户，常用的文件分为   

- 程序文件（program file）

​              如C++源程序文件.cpp；目标文件.obj；可执行文件.exe

- 数据文件（data file）

​              程序中输入和输出的对象就是数据文件

根据文件中数据的组织形式 

- ASCII文件：
    - 文本文件（text）或字符文件，它的每一个字符放一个ASCII代码
    - 可以直接在屏幕打印或者显示，直观便于阅读，但是占有内存多，花费转换时间
    - 如果是为了显示和打印供阅读，则用ASCII码形式输出，得到的ASCII文件可直接在显示屏观看

- 二进制文件：
    - 内部格式文件或字节文件，把内存中的数据按其在内存中的储存形式原样输出到磁盘上存放
    - 节省外存空间，不需要转换时间，但是一个字节并不对应一个字符，不能直接显示文件中的内容
    - 如果在程序运行过程中某些中间结果数据暂时保存在磁盘中，以后要输入到内存的，用二进制文件保存

::: tip 其他  

1. 对于字符信息，在内存中是以ASCII代码形式存放的，因此无论用ASCII文件输出和用二进制文件输出，其数据形式是一样的

2. 对于数值数据则不同，ASCII一个字符一个字节，而对于整数如 100000 按内部格式输出则四个字节

:::



#### I/Ｏ功能

Ｃ++提供流低级的I/Ｏ功能和高级I/Ｏ功能

##### 高级的I/Ｏ：

把若干个字节组合为一个有意义的单位（整数、字符串、用户自定义类型等），然后以ASCII字符形式输入和输出

例如，把数据从内存输送到显示器输出：

先将内存中的数据转换为ASCII字符，然后按各自的数据类型输出

优点：这种面向类型的输入输出对于用户方便

缺点：对于传输大容量文件，由于数据格式的转换，速度较慢，效率不高

##### 低级的I/Ｏ：

以字节为单位输入和输出，在输入和输出时不进行数据格式的转换，以二进制形式进行

通常在内存和设备之间传输一批字节

优点：输入输出速度快、效率高。一般大容量文件传输用无格式转换的I/Ｏ

缺点：不直观，难以判定数据内容



### 文件流与文件流对象

- Ｃ++的输入输出是由对象实现的，❓如`cin`和`cout`就是流对象
- 由于`cin`和`cout`已在`iostream`头文件中定义，用户不用自己定义
- `cin`和`cout`只能处理Ｃ++中以标准设备为对象的输入输出，而不能处理以磁盘文件为对象的输入输出
- 而在用磁盘文件时，由于情况各异，无法事先统一定义，必须由自己定义
    - 因此另外定义以磁盘文件为输出对象的输入输出流对象



#### 文件流

以外存文件为输入输出对象的数据流

- 输出文件流是从内存流向外存文件的数据

- 输入文件流是从外存文件流向内存的数据

- 每一个文件流都有一个内存缓冲区与之对应

::: tip 区分文件流与文件

文件流本身不是文件，而只是'**以文件为输入输出对象的流**'

若要对磁盘文件输入输出，就必须通过文件流来实现

:::

#### 用于文件操作的文件类

1. `ifstream`类

从`istream`类派生。用来支持从磁盘文件的输入

2. `ofstream`类

从`ostream`类派生。用来支持向磁盘文件的输出

3. `fstream`类

从`iostream`类派生。用来支持对磁盘文件的输入输出

要以磁盘文件为对象进行输入输出，必须定义一个文件流类的对象，通过文件流对象将数据从内存输出到磁盘文件，或者通过文件流对象从磁盘文件将数据输入到内存

对磁盘文件的操作时通过文件流对象（而不是`cin`和`cout`）实现的

::: tip 

文件流对象由'**文件流类**'定义，而不是`istream`和`ostream`类定义

:::



### 文件的打开与关闭

#### 打开磁盘文件

打开（open）文件是指在文件读写之前做的必要准备工作，包括：

为文件流对象和指定的磁盘文件建立关联，以便文件流流向指定的磁盘文件

指定文件的工作方式（输入还是输出，ASCII文件还是二进制文件）

**实现方法**：

1. 调用文件流的成员函数open

```cpp
ofstream outfile;         //定义ofstream类（输出文件流类）对象outfile
outfile.open("f1.dat",ios::out);  //使文件流与f1.dat文件建立关联
```

说明  

- 第二行是调用输出文件流的成员函数 `open()` 打开磁盘文件 `f1.dat` ,并指定它为输出文件，文件流对象 `outfile `将向磁盘文件 `f1.dat` 输出数据。
- `ios::out` 是I/Ｏ模式的一种，表示以输出方式打开一个文件（此时 `f1.dat` 是一个输出文件，接收从内存输出的数据）

2. 调用成员函数 `open()`的一般形式为

```cpp
文件流对象.open(磁盘文件名，输入输出方式); 
```

磁盘文件名可以包括路径，如`"c:\\new\\f1.dat"`,如果缺省路径，则默认当前目录下的文件

::: warning

要用 `\` 转义字符！！！！

:::

3. 在定义文件流对象时指定参数

在声明文件流类时定义了带参数的构造函数，其中包含了打开磁盘文件的功能。

因此可以在定义文件流对象的时候指定参数，调用文件流类的构造函数实现打开文件的功能，如

```cpp
ofstream outfile("f1.dat",ios::out);  //作用与open函数相同
```

输入输出方式见==??????==  ，输入输出方式是在 ios 类中定义的，它们是枚举常量

| 方式                   | 作用                                                         |
| ---------------------- | ------------------------------------------------------------ |
| `ios::in`              | 以输入方式打开文件。                                         |
| `ios::out`             | 以输出方式打开文件（这是默认方式），如果已有此名字的文件，则将其原有内容全部清除 |
| `ios::app`             | 以输出方式打开文件，写入的数据添加在文件末尾                 |
| `ios::ate`             | 打开一个已有文件，文件指针指向文件末尾                       |
| `ios::trunc`           | 打开一个文件，如果文件已存在，则删除其中全部数据；如果文件不存在，则建立新文件。如已指定了 ios::out 方   式，而未指定 ios::app、ios::ate、ios::in，则同时默认此方式 |
| `ios::binary`          | 以二进制打开一个文件，如果不指定此方式则默认为ASCII 方式     |
| `ios::nocreate`        | 打开一个已有文件，如果文件不存在则打开失败。no create 表示不能建立新文件 |
| `ios::noreplace`       | 如果文件不存在则建立新文件，如果文件已经存在则操作失败，no replace 表示不准更新现有文件 |
| `ios::in\| ios::out` | 以输入和输出方式打开文件，文件可读可写                       |
| `ios::out \|ios::binary` | 以二进制方式打开一个输出文件                                 |
| `ios::in \|ios::binary` | 以二进制方式打开一个输入文件                                 |

说明：

1. 新版本的 I/Ｏ 库中不提供 `ios::nocreat` 和 `ios::noreplace`

2. **文件指针**

    - 每一个打开的文件都有一个文件指针，该指针的初始位置由 I/Ｏ 方式指定，

    - 每次读写都从文件指针的当前位置开始

    - 每读入一个字节，指针就后移一个字节

    - 当文件指针移到最后，就会遇到文件结束（'文件结束符'也占一个字节，值为 -1），此时流对象的成员函数 `eof `的值为非0（一般设为1），表示文件结束了

    - 可以用‘位或’运算符 | 对输入输出方式进行组合，除了上面表中的例子之外

```cpp
ios::in|ios::nocreat     //打开一个输入文件，若文件不存在则返回打开失败的信息
ios::app|ios::nocreat  //打开一个输出文件，在文件结尾接着写数据，若文件不存在则返回一个打开失败信息
ios::out|ios::noreplace    //打开一个新文件作为输出文件，如果文件已经存在则返回打开失败
ios::in|ios::out|ios::binary //打开一个二进制文件，可读可写
```

但是不能组合互相排斥的方式

3. 如果打开操作失败，`open `函数的返回值为 `0`；如果是调用构造函数的方式打开文件的，则流对象的值为 0，以此测试打开是否成功

```cpp
if (outfile.open("f1.dat",ios::app)== 0) {
  cout <<"打开错误";
}
```

​        或者

```cpp
if (!outfile) {
    cout <<"打开文件错误";
}
```



#### 关闭磁盘文件

关闭文件用成员函数 `close`，如

```cpp
outfile.close();  //将输出文件流所关联的磁盘文件关闭
```

关闭文件实际上是接触该磁盘文件与文件流的关联，原来设置的工作方式也失效

这样就不能通过文件流对文件进行输入和输出

这时可以将文件流与其他磁盘文件建立关联，通过文件流对新的文件进行输入或输出，如

```cpp
outfile.open("f2.dat",ios::app|ios::nocreat);
```

此时文件流 `outfile`与 `f2.dat` 进行了关联，并指定了 `f2.dat` 的工作方式